<!DOCTYPE html>
<!-- Generated by Vantle::Web -->
<html lang="en" data-context="generation" data-page="autotest" data-root="../../../">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vantle.Autotest</title>
<link rel="icon" href="../../../resource/favicon.ico">
<script>try{let d=document.documentElement;let t=localStorage.getItem('theme');if(t)d.setAttribute('data-theme',t)}catch(e){}</script>
<link rel="stylesheet" href="../../../resource/system/document/vantle.css">
<script type="module">
import init from '../../../resource/system/document/compute.js';
await init();
</script>
</head>
<body>
<nav>
  <a class="nav-logo" href="../../../index.html">
    <img src="../../../resource/logo.png" alt="Vantle">
  </a>
  <div class="nav-links">
    <div class="nav-dropdown">
      <a href="../../../index.html">Vantle</a>
      <div class="nav-dropdown-menu">
        <a href="../../../info.html">Info</a>
        <a href="../../../notice.html">Notice</a>
        <a href="../../../module.html">Module</a>
        <a href="../../../license.html">License</a>
      </div>
    </div>
    <div class="nav-dropdown">
      <a href="../../../Molten/">Molten</a>
      <div class="nav-dropdown-menu">
        <a href="../../../Molten/system/spatialize/">Spatialize</a>
        <hr>
        <a href="../../../Molten/info.html">Info</a>
        <a href="../../../Molten/notice.html">Notice</a>
        <a href="../../../Molten/license.html">License</a>
      </div>
    </div>
    <div class="nav-dropdown">
      <a href="../../../system/generation/">Generation</a>
      <div class="nav-dropdown-menu">
        <a href="../../../system/generation/web/">Web</a>
        <a href="../../../system/generation/rust/">Autotest</a>
      </div>
    </div>
    <a href="../../../system/observation/">Observation</a>
    <a href="../../../system/spatialize/">Spatialize</a>
  </div>
</nav>
<div class="layout">
  <aside class="sidebar" aria-label="Page navigation">
    <div class="sidebar-label">Pages</div>
    <a href="../../../system/generation/">Generation</a>
    <a href="../../../system/generation/web/">Web</a>
    <a href="../../../system/generation/rust/" aria-current="page">Autotest</a>
    <div class="sidebar-label">Legal</div>
    <a href="../../../info.html">Info</a>
    <a href="../../../notice.html">Notice</a>
    <a href="../../../license.html">License</a>
  </aside>
  <main>
    <h1 id="autotest">Autotest</h1>
    <p class="subtitle">JSON-driven test generation for Rust</p>
    <hr>
    <p>Autotest eliminates test boilerplate by generating Rust test functions from templates and JSON case definitions. Write the logic once, define test data declaratively, and let the framework produce exhaustive test suites.</p>
    <hr>
    <section>
      <h2 id="template">Template</h2>
      <p>Write functions in a <code>.template.rs</code> file. Each function becomes a test generator:</p>
      <div class="code-block" data-language="rust"><span class="node-use"><span class="syntax-keyword">use</span> component<span class="syntax-punctuation">::</span>graph<span class="syntax-punctuation">::</span>state<span class="syntax-punctuation">::</span>particle<span class="syntax-punctuation">::</span><span class="syntax-entity">Particle</span><span class="syntax-punctuation">;</span>
</span>
<span class="node-function"><span class="syntax-keyword">fn</span> <span class="syntax-entity">disjoint</span><span class="node-parameters"><span class="syntax-punctuation">(</span><span class="node-parameter"><span class="node-pattern"><span class="syntax-variable">candidate</span></span><span class="syntax-punctuation">:</span> <span class="node-type"><span class="syntax-entity">Particle</span><span class="syntax-punctuation">&lt;</span><span class="node-type"><span class="syntax-entity">String</span></span><span class="syntax-punctuation">&gt;</span></span></span>, <span class="node-parameter"><span class="node-pattern"><span class="syntax-variable">basis</span></span><span class="syntax-punctuation">:</span> <span class="node-type"><span class="syntax-entity">Particle</span><span class="syntax-punctuation">&lt;</span><span class="node-type"><span class="syntax-entity">String</span></span><span class="syntax-punctuation">&gt;</span></span></span><span class="syntax-punctuation">)</span></span> <span class="syntax-operator">-&gt;</span> <span class="node-type"><span class="syntax-entity">Option</span><span class="syntax-punctuation">&lt;</span><span class="node-type"><span class="syntax-entity">Particle</span><span class="syntax-punctuation">&lt;</span><span class="node-type"><span class="syntax-entity">String</span></span><span class="syntax-punctuation">&gt;</span></span><span class="syntax-punctuation">&gt;</span></span><span class="node-block"> {
<span class="node-statement">    <span class="node-expression"><span class="node-expression"><span class="node-expression"><span class="syntax-variable">candidate</span></span><span class="syntax-punctuation">.</span><span class="syntax-function">disjoint</span><span class="syntax-punctuation">(</span><span class="node-expression"><span class="syntax-punctuation">&amp;</span><span class="node-expression"><span class="syntax-variable">basis</span></span></span><span class="syntax-punctuation">)</span></span><span class="syntax-punctuation">.</span><span class="syntax-function">map</span><span class="syntax-punctuation">(</span><span class="node-expression"><span class="syntax-punctuation">|</span><span class="node-pattern">_</span><span class="syntax-punctuation">|</span> <span class="node-expression"><span class="node-expression"><span class="syntax-variable">candidate</span></span><span class="syntax-punctuation">.</span><span class="syntax-function">clone</span><span class="syntax-punctuation">(</span><span class="syntax-punctuation">)</span></span></span><span class="syntax-punctuation">)</span></span>
</span>}
</span></span></div>
    </section>
    <hr>
    <section>
      <h2 id="cases">Cases</h2>
      <p>Define test data in <code>cases.json</code>. Each function specifies default parameters, expected returns, and individual cases that can override defaults:</p>
      <div class="code-block" data-language="json"><span class="node-object"><span class="syntax-punctuation">{</span>
<span class="node-property">    <span class="syntax-entity">"functions"</span><span class="syntax-punctuation">:</span> <span class="node-array"><span class="syntax-punctuation">[</span>
        <span class="node-object"><span class="syntax-punctuation">{</span>
<span class="node-property">            <span class="syntax-entity">"function"</span><span class="syntax-punctuation">:</span> <span class="node-value"><span class="syntax-string">"disjoint"</span><span class="syntax-punctuation">,</span>
</span></span><span class="node-property">            <span class="syntax-entity">"tags"</span><span class="syntax-punctuation">:</span> <span class="node-array"><span class="syntax-punctuation">[</span><span class="node-value"><span class="syntax-string">"particle"</span></span>, <span class="node-value"><span class="syntax-string">"disjoint"</span></span><span class="syntax-punctuation">]</span><span class="syntax-punctuation">,</span>
</span></span><span class="node-property">            <span class="syntax-entity">"parameters"</span><span class="syntax-punctuation">:</span> <span class="node-object"><span class="syntax-punctuation">{</span><span class="node-property"><span class="syntax-entity">"candidate"</span><span class="syntax-punctuation">:</span> <span class="node-array"><span class="syntax-punctuation">[</span><span class="node-array"><span class="syntax-punctuation">[</span><span class="node-value"><span class="syntax-string">"a"</span></span>, <span class="node-value"><span class="syntax-constant">1</span></span><span class="syntax-punctuation">]</span></span><span class="syntax-punctuation">]</span></span></span><span class="node-property">, <span class="syntax-entity">"basis"</span><span class="syntax-punctuation">:</span> <span class="node-array"><span class="syntax-punctuation">[</span><span class="node-array"><span class="syntax-punctuation">[</span><span class="node-value"><span class="syntax-string">"b"</span></span>, <span class="node-value"><span class="syntax-constant">1</span></span><span class="syntax-punctuation">]</span></span><span class="syntax-punctuation">]</span></span></span><span class="syntax-punctuation">}</span><span class="syntax-punctuation">,</span>
</span></span><span class="node-property">            <span class="syntax-entity">"returns"</span><span class="syntax-punctuation">:</span> <span class="node-object"><span class="syntax-punctuation">{</span><span class="node-property"><span class="syntax-entity">"()"</span><span class="syntax-punctuation">:</span> <span class="node-array"><span class="syntax-punctuation">[</span><span class="node-array"><span class="syntax-punctuation">[</span><span class="node-value"><span class="syntax-string">"a"</span></span>, <span class="node-value"><span class="syntax-constant">1</span></span><span class="syntax-punctuation">]</span></span><span class="syntax-punctuation">]</span></span></span><span class="syntax-punctuation">}</span><span class="syntax-punctuation">,</span>
</span></span><span class="node-property">            <span class="syntax-entity">"cases"</span><span class="syntax-punctuation">:</span> <span class="node-array"><span class="syntax-punctuation">[</span>
                <span class="node-object"><span class="syntax-punctuation">{</span>
<span class="node-property">                    <span class="syntax-entity">"tags"</span><span class="syntax-punctuation">:</span> <span class="node-array"><span class="syntax-punctuation">[</span><span class="node-value"><span class="syntax-string">"empty"</span></span><span class="syntax-punctuation">]</span><span class="syntax-punctuation">,</span>
</span></span><span class="node-property">                    <span class="syntax-entity">"parameters"</span><span class="syntax-punctuation">:</span> <span class="node-object"><span class="syntax-punctuation">{</span><span class="node-property"><span class="syntax-entity">"basis"</span><span class="syntax-punctuation">:</span> <span class="node-array"><span class="syntax-punctuation">[]</span></span></span><span class="syntax-punctuation">}</span><span class="syntax-punctuation">,</span>
</span></span><span class="node-property">                    <span class="syntax-entity">"returns"</span><span class="syntax-punctuation">:</span> <span class="node-object"><span class="syntax-punctuation">{</span><span class="node-property"><span class="syntax-entity">"()"</span><span class="syntax-punctuation">:</span> <span class="node-array"><span class="syntax-punctuation">[</span><span class="node-array"><span class="syntax-punctuation">[</span><span class="node-value"><span class="syntax-string">"a"</span></span>, <span class="node-value"><span class="syntax-constant">1</span></span><span class="syntax-punctuation">]</span></span><span class="syntax-punctuation">]</span></span></span><span class="syntax-punctuation">}</span>
</span></span>                <span class="syntax-punctuation">}</span>
</span>            <span class="syntax-punctuation">]</span>
</span></span>        <span class="syntax-punctuation">}</span>
</span>    <span class="syntax-punctuation">]</span>
</span></span><span class="syntax-punctuation">}</span></span></div>
    </section>
    <hr>
    <section>
      <h2 id="macro">Macro</h2>
      <p>Two Starlark macros work as a pair. The template compiles as a <code>rust_library</code> for IDE support. The generator reads the template and cases, then produces a <code>.generated.rs</code> test file that runs via <code>rust_test</code>.</p>
      <div class="code-block" data-language="starlark"><span class="syntax-macro">load</span><span class="syntax-punctuation">(</span><span class="syntax-string">&quot;</span><span class="syntax-string">//component/generation/starlark:defs.bzl</span><span class="syntax-string">&quot;</span><span class="syntax-punctuation">,</span> <span class="syntax-string">&quot;</span><span class="syntax-string">rust_autotest</span><span class="syntax-string">&quot;</span><span class="syntax-punctuation">,</span> <span class="syntax-string">&quot;</span><span class="syntax-string">rust_autotest_template</span><span class="syntax-string">&quot;</span><span class="syntax-punctuation">)</span>

<span class="syntax-function">rust_autotest_template</span><span class="syntax-punctuation">(</span>
    <span class="syntax-variable">name</span> <span class="syntax-operator">=</span> <span class="syntax-string">&quot;</span><span class="syntax-string">template</span><span class="syntax-string">&quot;</span><span class="syntax-punctuation">,</span>
    <span class="syntax-variable">src</span> <span class="syntax-operator">=</span> <span class="syntax-string">&quot;</span><span class="syntax-string">function.template.rs</span><span class="syntax-string">&quot;</span><span class="syntax-punctuation">,</span>
    <span class="syntax-variable">deps</span> <span class="syntax-operator">=</span> <span class="syntax-punctuation">[</span><span class="syntax-string">&quot;</span><span class="syntax-string">//Molten/component/graph/state/particle:module</span><span class="syntax-string">&quot;</span><span class="syntax-punctuation">]</span><span class="syntax-punctuation">,</span>
<span class="syntax-punctuation">)</span>

<span class="syntax-function">rust_autotest</span><span class="syntax-punctuation">(</span>
    <span class="syntax-variable">name</span> <span class="syntax-operator">=</span> <span class="syntax-string">&quot;</span><span class="syntax-string">function</span><span class="syntax-string">&quot;</span><span class="syntax-punctuation">,</span>
    <span class="syntax-variable">template</span> <span class="syntax-operator">=</span> <span class="syntax-string">&quot;</span><span class="syntax-string">:template</span><span class="syntax-string">&quot;</span><span class="syntax-punctuation">,</span>
    <span class="syntax-variable">cases</span> <span class="syntax-operator">=</span> <span class="syntax-string">&quot;</span><span class="syntax-string">:cases.json</span><span class="syntax-string">&quot;</span><span class="syntax-punctuation">,</span>
    <span class="syntax-variable">deps</span> <span class="syntax-operator">=</span> <span class="syntax-punctuation">[</span><span class="syntax-string">&quot;</span><span class="syntax-string">//Molten/component/graph/state/particle:module</span><span class="syntax-string">&quot;</span><span class="syntax-punctuation">]</span><span class="syntax-punctuation">,</span>
<span class="syntax-punctuation">)</span></div>
      <section>
        <h3 id="rust-autotest-template">rust_autotest_template</h3>
        <p>Validates template compilation and enables IDE support. Automatically adds <code>-A dead_code</code>.</p>
        <table>
          <thead>
            <tr>
              <th>Parameter</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <code>src</code>
              </td>
              <td>Template source file</td>
            </tr>
            <tr>
              <td>
                <code>deps</code>
              </td>
              <td>Template dependencies</td>
            </tr>
          </tbody>
        </table>
      </section>
      <section>
        <h3 id="rust-autotest">rust_autotest</h3>
        <p>Generates and runs test functions. Standard dependencies (<code>serde</code>, <code>serde_json</code>, <code>vantle</code>) are auto-included.</p>
        <table>
          <thead>
            <tr>
              <th>Parameter</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <code>template</code>
              </td>
              <td>
Template target from                 <code>rust_autotest_template</code>
              </td>
            </tr>
            <tr>
              <td>
                <code>cases</code>
              </td>
              <td>JSON test case definitions</td>
            </tr>
            <tr>
              <td>
                <code>deps</code>
              </td>
              <td>Custom dependencies beyond defaults</td>
            </tr>
          </tbody>
        </table>
      </section>
    </section>
    <hr>
    <section>
      <h2 id="features">Features</h2>
      <ul>
        <li><strong>Parameter shadowing</strong>: Function-level defaults with case-level overrides</li>
        <li><strong>Tag organization</strong>: Filter tests by tags</li>
        <li><strong>Schema validation</strong>: Parameters match function signatures</li>
        <li><strong>Rich diagnostics</strong>: Error reporting via miette with source locations</li>
      </ul>
    </section>
    <footer>
      <p>© 2025 Vantle · <a href="https://vantle.org">@robert.vanderzee</a></p>
      <a class="footer-icon" href="https://github.com/Vantle/Vantle" aria-label="GitHub"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a>
    </footer>
  </main>
  <aside class="outline" aria-label="Table of contents">
    <a href="#autotest" data-depth="0">Autotest</a>
    <a href="#template" data-depth="1">Template</a>
    <a href="#cases" data-depth="1">Cases</a>
    <a href="#macro" data-depth="1">Macro</a>
    <a href="#rust-autotest-template" data-depth="2">rust_autotest_template</a>
    <a href="#rust-autotest" data-depth="2">rust_autotest</a>
    <a href="#features" data-depth="1">Features</a>
  </aside>
</div>
</body>
</html>
